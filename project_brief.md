# 專案簡報：LINE 占卜 & 心情陪伴 AI 師

> **版本**：1.0
> **日期**：2025-07-04

---

## 1. 專案願景：您的專屬心靈夥伴

本專案旨在打造一個不止於回覆的 LINE 智慧夥伴。我們結合先進的 AI 技術，創造出一個能提供**塔羅占卜**、**傾聽心事**、並給予**溫暖陪伴**的 AI 師。

我們的目標是讓科技充滿溫度，在使用者需要指引或情緒支持時，成為最即時、最私密的依靠。

---

## 2. 核心功能

**多模態互動**
- **文字**：深度對話，解答疑惑。
- **圖片**：解讀圖像，提供洞見。
- **語音**：傾聽心聲，即時轉譯與回應。

**AI 占卜師**
- **塔羅抽牌**：隨機抽取塔羅牌，提供初步指引。
- **語意解析 (RAG)**：根據您的問題，從塔羅牌知識庫中找出最相關的牌義解讀，提供更個人化的分析。

**高度可擴展性**
- **工具整合**：基於 LangChain Agent 架構，能輕易整合天氣查詢、新聞摘要、知識庫檢索等多元工具。
- **API 串接**：架構清晰，易於串接更多第三方服務。

---

## 3. 技術架構深度解析

本專案採用模組化、可擴展的技術架構，確保系統的穩定與高效。

- **接入層 (LINE Messaging API)**：作為使用者互動的唯一入口。所有來自 LINE 的訊息（文字、圖片、語音）都會透過 Webhook 安全地傳遞到我們的後端服務。

- **應用層 (FastAPI)**：我們選擇 FastAPI 作為後端框架，因其具備高效能的非同步處理能力 (asyncio)，能輕鬆應對大量併發請求。此層負責：
    - **驗證請求**：確保請求來自 LINE 平台。
    - **解析事件**：識別訊息類型（如文字、圖片）並分派給對應的處理器。
    - **管理背景任務**：將耗時的 AI 處理（如語音辨識、LLM 推理）放入背景執行，避免請求超時，提升使用者體驗。

- **智能核心 (LangChain Agent)**：這是整個系統的大腦。我們使用 LangChain Agent 來實現複雜的邏輯判斷與工具調用。
    - **動態決策**：Agent 會根據使用者的輸入，自主判斷何時需要查詢資料庫、何時需要呼叫外部 API，或何時直接生成回覆。
    - **工具箱 (Toolbox)**：我們將塔羅牌查詢、RAG 檢索等功能封裝成獨立的「工具」。Agent 可以在需要時取用這些工具，實現了功能的高度模組化。

- **模型層 (OpenAI GPT-4o & RAG)**：
    - **GPT-4o**：作為主要的語言模型，負責理解使用者意圖、生成流暢的回應，並在需要時驅動 Agent。
    - **RAG (Retrieval-Augmented Generation)**：我們將塔羅牌專業知識儲存在 Qdrant 向量資料庫中。當使用者提出相關問題時，系統會先從資料庫中檢索最相關的知識片段，再將其與原始問題一併交給 GPT-4o，從而生成更精準、更有深度的專業回答。

- **數據層 (Qdrant)**：高效能的向量資料庫，專為語意搜尋設計。它讓我們能夠快速地在數百萬條知識中找到與使用者問題最相關的內容。

```mermaid
graph TD
    subgraph 用戶端
        A[使用者 @ LINE]
    end

    subgraph 後端服務 (FastAPI)
        B[Webhook 接入點]
        C{事件分派器}
        D[背景任務處理]
    end

    subgraph AI 核心
        E(LangChain Agent)
        F[工具箱]
        G[OpenAI GPT-4o]
    end

    subgraph 知識庫
        H(RAG 檢索模組)
        I[Qdrant 向量資料庫]
    end

    A -- 訊息 --> B
    B --> C
    C -- 分派任務 --> D
    D -- 觸發 AI --> E
    E -- 思考 & 決策 --> G
    E -- 需要工具時 --> F
    F -- 觸發 RAG --> H
    H -- 向量搜尋 --> I
    I -- 返回相關知識 --> H
    H -- 增強上下文 --> G
    G -- 生成最終回覆 --> D
    D -- 透過 LINE API 回覆 --> A
```

---

## 4. 功能擴展與未來藍圖

得益於模組化的架構，擴展新功能變得簡單而高效。以下是我們的擴展策略與未來規劃：

### 如何擴展新功能？

1.  **新增工具 (Tool)**：
    - **場景**：整合「天氣查詢」功能。
    - **步驟**：
        1.  在 `agents/tools.py` 中定義一個新的 Python 函數，例如 `get_weather(city: str)`。
        2.  使用 `@tool` 裝飾器將其註冊為 LangChain 工具。
        3.  在 `app.py` 中將此新工具加入 Agent 的工具箱列表。
    - **優勢**：無需修改核心邏輯，Agent 會自動學會何時使用這個新工具。

2.  **擴充知識庫 (RAG)**：
    - **場景**：加入「周公解夢」知識。
    - **步驟**：
        1.  準備一份包含解夢知識的資料檔案（如 Markdown 或 CSV）。
        2.  執行資料導入腳本，將文件內容轉換為向量並存入 Qdrant 資料庫，同時標記其領域為「解夢」。
        3.  Agent 在處理相關問題時，便能自動從該領域檢索資訊。
    - **優勢**：知識擴充與主程式碼分離，易於維護與更新。

### 未來藍圖

- **短期 (1-3 個月)**
    - **個人化記憶**：整合 `ConversationBufferMemory`，讓 AI 師記住短期對話上下文，提供更連貫的交流體驗。
    - **情緒分析整合**：引入開源的情緒分析模型，在每次對話後分析使用者情緒，作為後續互動的參考。
    - **知識庫擴充**：新增「星座運勢」與「生命靈數」知識庫。

- **中期 (3-6 個月)**
    - **長期記憶資料庫**：建立獨立的用戶資料庫，儲存關鍵對話摘要與用戶偏好，實現跨對話週期的個人化服務。
    - **主動關懷系統 (Proactive Messaging)**：基於用戶設定或情緒低落時，透過 LINE Push API 發送定時或即時的關懷訊息。

- **長期 (6 個月以上)**
    - **多 Agent 協作**：建立專門的「占卜 Agent」、「傾聽 Agent」和「知識查詢 Agent」。由一個主 Agent 負責將使用者的請求分派給最適合的專家 Agent 處理，實現更專業的分工。
    - **開放平台**：允許開發者貢獻新的工具或知識庫，打造一個開放、共創的心靈陪伴生態系。

---

**簡報完畢，謝謝。**
